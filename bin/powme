#!/usr/bin/env ruby

require "rubygems"
require "colored"

class PowMe
  def run
    puts "powme".bold.blue
    puts "\n"
    puts "attempting to configure your pow application".yellow
    ensure_rvmrc_is_present!
    ensure_symlink_does_not_exist!
    symlink
  end

  def ensure_rvmrc_is_present!
    unless rvmrc_exists?
      puts ".rvmrc doesn't exist".red
      exit 1
    end
  end

  def ensure_symlink_does_not_exist!
    if File.symlink? proposed_pow_app_name_directory
      puts "app '#{app_name}' already exists".red
      exit 1
    end
  end

  def symlink
    puts "http://#{app_name}.dev created!".green
    File.symlink(pwd, proposed_pow_app_name_directory)
  end

  def proposed_pow_app_name_directory
    File.join(pow_directory, app_name)
  end

  def pow_directory
    File.join(ENV["HOME"], ".pow")
  end

  def pwd
    `pwd`.strip
  end

  def rvmrc_exists?
    File.exist? File.join(pwd, ".rvmrc")
  end

  def app_name
    pwd.split("/").last
  end
end

PowMe.new.run
