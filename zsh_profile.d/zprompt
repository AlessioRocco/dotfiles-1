_git_prompt_info() {
  ref=$(git symbolic-ref HEAD 2> /dev/null)
  if [[ -n $ref ]]; then
    echo "${ref#refs/heads/}"
  fi
}

_git_status() {
  git_status=$(git status)
  if [ -n "$(echo $git_status | grep 'Changed but not updated' 2> /dev/null)" ]; then
    echo "changed"
  elif [ -n "$(echo $git_status | grep 'Changes to be committed' 2> /dev/null)" ]; then
    echo "pending"
  elif [ -n "$(echo $git_status | grep 'Untracked files' 2> /dev/null)" ]; then
    echo "untracked"
  else
    echo "unchanged"
  fi
}

_git_prompt_color() {
  if [ -n "$1" ]; then
    current_git_status=$(_git_status)
    if [ "changed" = $current_git_status ]; then
      echo " %{$fg_bold[red]%}$1%{$reset_color%}"
    elif [ "pending" = $current_git_status ]; then
      echo " %{$fg_bold[yellow]%}$1%{$reset_color%}"
    elif [ "unchanged" = $current_git_status ]; then
      echo " %{$fg_bold[green]%}$1%{$reset_color%}"
    elif [ "untracked" = $current_git_status ]; then
      echo " %{$fg_bold[cyan]%}$1%{$reset_color%}"
    fi
  else
    echo "$1"
  fi
}

_grey()         { echo "%{$fg_bold[grey]%}$1%{$reset_color%}" }
_colored_path() { echo "%{$fg_bold[white]%}%~%{$reset_color%}" }

# prompt
export PS1='$(_grey "[") %n $(_colored_path)$(_git_prompt_color $(_git_prompt_info)) $(_grey "]") '
